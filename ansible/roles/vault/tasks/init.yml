---
- name: Init vault
  ansible.builtin.command: vault operator init -format=json
  changed_when: true
  register: vault_init_results

- name: Print vault operator init result
  ansible.builtin.debug: "{{ vault_init_results | to_nice_json }}"

- name: Parse output of vault init
  ansible.builtin.set_fact:
    vault_init_parsed: "{{ vault_init_results.stdout | from_json }}"

- name: Vault seal keys saved
  ansible.builtin.pause:
    prompt: Please confirm you have saved vault seal keys and root token ! Press return to continue.

- name: Unseal vault
  ansible.builtin.command: "vault operator unseal {{ item }}"
  changed_when: true
  with_items: "{{ vault_init_parsed.unseal_keys_hex }}"
