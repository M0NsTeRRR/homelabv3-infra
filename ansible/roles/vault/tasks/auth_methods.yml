---
- name: Enable vault auth method {{ item.name }}
  ansible.builtin.command: vault auth enable {{ item.name }}
  changed_when: true

- name: Write values to {{ vault_data.path }}
  community.hashi_vault.vault_write:
    url: https://{{ inventory_hostname }}:8201
    path: "{{ vault_data.path }}"
    data: "{{ vault_data.data }}"
    auth_method: token
    token: "{{ vault_token }}"
  with_items: "{{ item.data }}"
  loop_control:
    loop_var: vault_data