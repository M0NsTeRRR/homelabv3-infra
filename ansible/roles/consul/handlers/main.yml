---
- name: Daemon-reload
  ansible.builtin.systemd:
    daemon_reload: true

- name: Restart consul.service
  ansible.builtin.systemd:
    name: consul.service
    state: restarted

- name: Enable consul.service
  ansible.builtin.systemd:
    name: consul.service
    enabled: true

- name: Restart envoy.service
  ansible.builtin.systemd:
    name: envoy-{{ item.name }}.service
    state: restarted
  with_items: "{{ consul_services }}"

- name: Enable envoy.service
  ansible.builtin.systemd:
    name: envoy-{{ item.name }}.service
    enabled: true
  with_items: "{{ consul_services }}"
