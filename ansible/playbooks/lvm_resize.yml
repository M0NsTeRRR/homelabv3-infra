---
- name: Resize LVM partition
  hosts: all
  become: true
  tasks:
    - name: LC_ALL=C sudo growpart /dev/sda 2
      ansible.builtin.shell: LC_ALL=C sudo growpart /dev/sda 2
      changed_when: false

    - name: LC_ALL=C sudo growpart /dev/sda 5
      ansible.builtin.shell: LC_ALL=C sudo growpart /dev/sda 5
      changed_when: false

    - name: Pvresize /dev/sda5
      ansible.builtin.command: pvresize /dev/sda5
      changed_when: false

    - name: "Extend all free spaces on lvol root {{ item.key }}"
      community.general.lvol:
        vg: "{{ item.key }}"
        lv: root
        size: 100%FREE
        resizefs: true
      with_dict: "{{ ansible_lvm['vgs'] }}"
