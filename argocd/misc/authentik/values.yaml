global:
  env:
    - name: AUTHENTIK_DISABLE_STARTUP_ANALYTICS
      value: "true"
    - name: AUTHENTIK_DISABLE_UPDATE_CHECK
      value: "true"
    - name: AUTHENTIK_ERROR_REPORTING__ENABLED
      value: "false"
    - name: AUTHENTIK_POSTGRESQL__HOST
      value: "authentik-cluster-rw"
    - name: AUTHENTIK_POSTGRESQL__SSLMODE
      value: verify-ca
    - name: AUTHENTIK_POSTGRESQL__SSLROOTCERT
      value: /etc/ssl/certs/homelab.crt
  envFrom:
    - secretRef:
        name: authentik-vault
  volumes:
    - name: &volume-ca ca-certs
      configMap:
        name: homelab-ca
    - name: &volume-bluprint homelab-blueprint
      secret:
        secretName: blueprint-vault
        items:
          - key: homelab.yaml
            path: homelab.yaml
  volumeMounts:
    - name: *volume-ca
      mountPath: /etc/ssl/certs/homelab.crt
      subPath: ca.crt
      readOnly: true
    - name: *volume-bluprint
      mountPath: /blueprints/custom/homelab.yaml
      subPath: homelab.yaml
      readOnly: true
redis:
  enabled: true
server:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
  volumes:
    - name: &volume-icons icons
      configMap:
        name: authentik-icons
  volumeMounts:
    - name: *volume-icons
      mountPath: /media/public/unicornafk.svg
      subPath: unicornafk.svg
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: "vault"
      cert-manager.io/private-key-algorithm: "RSA"
      cert-manager.io/private-key-size: "4096"
    hosts:
      - &host sso.unicornafk.fr
    paths:
      - /
    pathType: ImplementationSpecific
    tls:
      - hosts:
          - *host
        secretName: sso.unicornafk.fr-tls
    ingressClassName: ingress-internal
prometheus:
  rules:
    enabled: true
